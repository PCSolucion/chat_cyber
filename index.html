<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Twitch Chat Overlay - Cyberpunk 2077</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSS Modular - Importa todos los componentes -->
  <link rel="stylesheet" href="css/bundle.css">
  <link rel="stylesheet" href="css/achievements.css?v=8">
  <link rel="stylesheet" href="css/idle-stats.css">
  <link rel="stylesheet" href="css/levelup.css">
</head>

<body>
  <!-- Cyberpunk Level Up Overlay (Global Position) -->
  <div id="cp-levelup-overlay" class="cp-levelup-overlay">
    <div class="cp-levelup-content">
      <div class="cp-levelup-icon">
        <svg class="cp-hex-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
          <polygon points="50 0, 95 25, 95 75, 50 100, 5 75, 5 25" />
        </svg>
        <div class="cp-hex-arrows">
          <span>^</span>
          <span>^</span>
          <span>^</span>
        </div>
      </div>
      <div class="cp-levelup-bar">
        <div class="cp-levelup-main-text">
          <span class="cp-level-arrow">‚ñ≤</span>
          <span id="cp-new-level" class="cp-level-number">66</span>
          <span class="cp-level-text">LEVEL UP!</span>
          <div class="cp-level-decor-right">
            <svg class="cp-level-decor-icon" viewBox="0 0 24 24">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
            </svg>
          </div>
        </div>
        <div class="cp-levelup-sub-bar">
          <div class="cp-stat-box">
            <span class="cp-stat-icon">üë§</span>
            <span class="cp-stat-label">MERC:</span>
            <span id="cp-username" class="cp-stat-value">NETRUNNER</span>
          </div>
          <div class="cp-stat-box">
            <span class="cp-stat-icon">‚ó§</span>
            <span class="cp-stat-label">NEW RANK:</span>
            <span id="cp-new-title" class="cp-stat-value">ROOKIE</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-wrapper">
    <div class="container" role="region" aria-label="Chat de Twitch">

      <!-- Animated border glow -->
      <div class="border-glow"></div>

      <!-- Status bar top -->
      <div class="status-bar">
        <span class="status-text" id="system-status-text">SYS.ONLINE</span>
        <span class="status-divider">|</span>
        <span class="status-code" id="stream-category">CHAT.STREAM</span>
      </div>

      <!-- Header with username -->
      <div class="header">
        <div class="info-container">
          <!-- XP System Display (Moved to Top) -->
          <div class="xp-section" id="xp-section"
            style="margin-top: -10px; margin-bottom: 8px; border-top: none; border-bottom: 1px solid rgba(255, 58, 58, 0.2);">
            <!-- Level Up Notification -->
            <div class="xp-levelup-inline" id="xp-levelup-inline">
              <span class="levelup-star">‚òÖ</span>
              <span class="levelup-text">LEVEL UP</span>
              <span class="levelup-chevrons">‚ùØ‚ùØ‚ùØ</span>
              <span class="levelup-number" id="levelup-number">2</span>
            </div>

            <!-- XP Bar -->
            <div class="xp-bar-inline" id="xp-bar-inline">
              <div class="xp-level-container">
                <span class="xp-level-label">LVL</span>
                <span class="xp-level-value" id="xp-level">1</span>
              </div>
              <div class="xp-progress-container">
                <div class="xp-progress-bar">
                  <div class="xp-progress-ghost" id="xp-progress-ghost"></div>
                  <div class="xp-progress-fill" id="xp-progress-fill"></div>
                  <div class="xp-progress-glow"></div>
                </div>
                <div class="xp-progress-text">
                  <span class="xp-current" id="xp-current">0</span>
                  <span class="xp-divider">/</span>
                  <span class="xp-next" id="xp-next">100</span>
                  <span class="xp-suffix">XP</span>
                </div>
              </div>
              <div class="xp-gain-container" id="xp-gain-container"></div>
            </div>

            <!-- XP Title -->
            <div class="xp-title-inline" id="xp-title-inline">
              <span class="xp-title-icon">‚óÜ</span>
              <span class="xp-title-text" id="xp-title">CIVILIAN</span>
              <span class="xp-streak" id="xp-streak" style="display: none;"></span>
            </div>
          </div>

          <div class="title-row">
            <span class="mission-icon">!</span>
            <img id="admin-icon" src="img/arasaka.png" class="admin-icon" alt="Corp">
            <span class="driver-name" id="username" data-text="NETRUNNER">NETRUNNER</span>

            <div class="user-identity-stack">
              <span class="user-badge" id="user-badge"></span>
            </div>
          </div>


        </div>
        <div class="header-right">
          <div class="live-badge">LIVE</div>
          <div class="header-deco">
            <span></span><span></span><span></span>
          </div>
        </div>
      </div>

      <!-- Data stream indicator -->
      <div class="data-stream">
        <div class="stream-line"></div>
      </div>

      <!-- Digital Particles BG (Top Users) -->
      <div id="particles-bg" class="particles-bg"></div>

      <!-- Equalizer / Audio visualizer (generado din√°micamente por UIUtils.initEqualizer) -->
      <div class="equalizer" id="equalizer" aria-hidden="true"></div>

      <!-- Message display -->
      <div class="quote" id="message" role="status" aria-live="polite">
        "Conectando al stream de Night City..."
      </div>



      <!-- Achievement Notifications (Dentro del widget) -->
      <div class="achievement-notifications" id="achievement-notifications"></div>

      <!-- Achievement Counter (Absolute position near footer) -->
      <div class="xp-achievements-container" id="xp-achievements-container-wrapper" style="
        position: absolute;
        bottom: 0px; 
        left: 0;
        width: 100%;
        padding: 0 15px;
        padding-bottom: 2px; /* Tiny spacer from absolute bottom edge */
        box-sizing: border-box;
        z-index: 10;
        pointer-events: none;
      ">
        <span class="xp-achievements" id="xp-achievements" style="display: none;"></span>
      </div>

      <!-- Footer tech info -->
      <div class="footer-tech">
      </div>
    </div>
  </div>

  <!-- 
    Panel de Pruebas ELIMINADO de este archivo.
    Ahora disponible en: test-panel.html
    
    Para testear el widget, abre test-panel.html en el navegador.
    El panel cargar√° el widget en un iframe y permitir√° simular mensajes.
  -->

  <!-- Scripts externos -->
  <script src="https://cdn.jsdelivr.net/npm/regenerator-runtime@0.13.7/runtime.min.js"></script>
  <script src="libs/tmi.min.js"></script>

  <!-- Configuraci√≥n -->
  <script src="js/config.js"></script>

  <!-- Utilidades -->
  <script src="js/utils/UIUtils.js"></script>

  <!-- Servicios -->
  <script src="js/services/AudioService.js"></script>
  <script src="js/services/TwitchService.js"></script>
  <script src="js/services/RankingSystem.js"></script>
  <script src="js/services/GistStorageService.js"></script>
  <script src="js/services/ExperienceService.js"></script>
  <script src="data/AchievementsData.js?v=2"></script>
  <script src="js/services/AchievementService.js"></script>
  <script src="js/services/ThirdPartyEmoteService.js"></script>
  <script src="js/services/SessionStatsService.js"></script>

  <!-- Managers -->
  <script src="js/managers/UIManager.js"></script>
  <script src="js/managers/XPDisplayManager.js"></script>
  <script src="js/managers/IdleDisplayManager.js"></script>
  <script src="js/managers/NotificationManager.js?v=3"></script>
  <script src="js/managers/MessageProcessor.js"></script>

  <!-- Aplicaci√≥n principal -->
  <script src="js/app.js"></script>

  <!-- Fallback para navegadores sin JavaScript -->
  <noscript>
    <div style="text-align: center; padding: 20px; color: white;">
      Este overlay requiere JavaScript para funcionar.
    </div>
  </noscript>
</body>

</html>